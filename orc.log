./app/models/orchids_name.rb
24,25c24,25
<   belongs_to :standalone_instance, class_name: 'Instance', foreign_key: 'standalone_instance_id'
<   belongs_to :instance_type, foreign_key: :relationship_instance_type_id
---
>   belongs_to :standalone_instance, class_name: "Instance", foreign_key: 'standalone_instance_id', optional: true
>   belongs_to :instance_type, foreign_key: :relationship_instance_type_id, optional: true
27c27
<   belongs_to :tree_element, foreign_key: 'standalone_instance_id'
---
>   belongs_to :tree_element, foreign_key: 'standalone_instance_id', optional: true
33c33
<   validates :relationship_instance_type_id, :presence => true, :unless => "orchid.accepted?"
---
>   validates :relationship_instance_type_id, presence: true, unless: -> {orchid.accepted?}
51d50
<     debug("create_instance")
54,55c53
<       debug("OrchidsName#create_instance orchid is accepted")
<       return create_or_find_standalone_instance
---
>       create_or_find_standalone_instance
57,58c55
<       debug("OrchidsName#create_instance orchid is synonym")
<       return create_or_find_relationship_instance
---
>       create_or_find_relationship_instance
60d56
<       debug("OrchidsName#create_instance orchid is hybrid")
63c59
<       return create_or_find_misapplied_instance
---
>       create_or_find_misapplied_instance
69,70c65,66
<     return 0 if standalone_instance?
<     debug 'no standalone instance, so we will create one'
---
>     return if standalone_instance?
>     debug 'no standalone instance'
75d70
<     debug('create_standalone_instance')
86,91d80
<     return 1
<   rescue => e
<     logger.error("OrchidsName#create_standalone_instance: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
<     @message = e.to_s.sub(/uncaught throw/,'').gsub(/"/,'')
<     render 'error'
115,116c104,105
<       debug '        Relationship instance already there returning 0'
<       return 0
---
>       debug '        Relationship instance already there'
>       return
119,120c108,109
<       debug '        Relationship instance found returning 0'
<       return 0
---
>       debug '        Relationship instance found'
>       return
123c112
<     return create_relationship_instance
---
>     create_relationship_instance
146c135
<       return 0
---
>       return false
150c139,140
<     new_instance.draft = false
---
>     new_instance.draft = true
>     debug('before....a')
151a142
>     debug('before....b')
152a144
>     debug('before....c')
153a146
>     debug('before....d')
154a148
>     debug('before....e')
155a150
>     debug("relationship_instance_type_id: #{relationship_instance_type_id}")
156a152
>     debug('before....f')
157a154,155
>     debug('before....g')
>     debug('about to save the instance')
158a157
>     debug("new relationship instance: #{new_instance.inspect}")
162d160
<     return 1
169c167
<       return 0
---
>       return
173c171
<       return 0
---
>       return
181c179
<     new_instance.draft = false
---
>     new_instance.draft = true
188a187
>     debug("new misapplied instance: #{new_instance.inspect}")
192,196d190
<     return 1
<   rescue => e
<     logger.error("OrchidsName#create_misapplied_instance: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
<     return 0
./app/models/orchid.rb
24c24
<     belongs_to :parent, class_name: "Orchid", foreign_key: "parent_id"
---
>     belongs_to :parent, class_name: "Orchid", foreign_key: "parent_id", optional: true
30c30
<     has_many :preferred_match, class_name: :OrchidsName, foreign_key: :orchid_id
---
>     has_many :preferred_match, class_name: "OrchidsName", foreign_key: :orchid_id
44,47d43
<   validates :synonym_type,
<             presence: { if: "record_type == 'synonym'",
<                         message: "is required." }
<  
67a64,65
>         .where(["duplicate_of_id is null"])
>         .where("exists (select null from instance where name_id = name.id)")
76c74
<   def name_match_no_primary?
---
>   def name_match_no_primary
80,87d77
<   def matches_with_primary
<     Name.where(["(name.simple_name = ? or name.simple_name = ?) and exists (select null from name_type nt where name.name_type_id = nt.id and scientific) and exists (select null from instance i join instance_type t on i.instance_type_id = t.id where i.name_id = name.id and t.primary_instance)", taxon, alt_taxon_for_matching])
<   end
< 
<   def no_matches_with_primary?
<     matches_with_primary.empty?
<   end
<   
137,140c127,149
<   # r relationship
<   # i instance
<   # t type
<   # i id
---
>   def riti_old
>     return nil if accepted?
>     return InstanceType.find_by_name('misapplied').id if misapplied?
>     if heterotypic?
>       if pp?
>         return InstanceType.find_by_name('pro parte taxonomic synonym').id
>       else
>         return InstanceType.find_by_name('taxonomic synonym').id
>       end
>     elsif homotypic?
>       Rails.logger.debug('homotypic')
>       if pp?
>         Rails.logger.debug('pp')
>         return InstanceType.find_by_name('pro parte nomenclatural synonym').id
>       else
>         return InstanceType.find_by_name('nomenclatural synonym').id
>       end
>     else
>       throw "Neither accepted nor misapplied nor heterotypic nor homotypic: orchid: #{id}: #{taxon} #{record_type}"
>     end
>     throw "No relationship instance type id for orchid: #{id}: #{taxon}"
>   end
> 
158,159d166
<     elsif synonym_type.blank?
<       throw "The orchid is a synonym with no synonym type - please set a synonym type in 'Edit Raw' then try again."
161c168
<       throw "Orchid#riti cannot work out an instance type for orchid: #{id}: #{taxon} #{record_type} #{synonym_type}"
---
>       throw "Cannot work out instance type for orchid: #{id}: #{taxon} #{record_type} #{synonym_type}"
163c170
<     throw "Orchid#riti is stuck with no relationship instance type id for orchid: #{id}: #{taxon}"
---
>     throw "No relationship instance type id for orchid: #{id}: #{taxon}"
255d261
<     debug('create_instance_for_preferred_matches_for')
257a264
>     #debug "Using ref: #{@ref.citation}"
269d275
<     debug("create_instance_for_preferred_matches")
275,278c281
<   # check for preferred name
<   def self.add_to_tree_for(draft_tree, taxon_s)
<     count = 0
<     errors = ''
---
>   def self.add_to_tree_for(taxon_s)
280,282c283
<       placer = AsTreePlacer.new(draft_tree, match)
<       count += placer.placed_count
<       errors += placer.error + ';' unless placer.error.blank?
---
>       placer = AsTreePlacer.new('Minor Edits 19 November 2019', match)
284d284
<     return count, errors
302,305d301
<   def synonym_without_synonym_type?
<     synonym? & synonym_type.blank?
<   end
< 
309c305
<     Rails.logger.debug("Orchid##{msg}")
---
>     Rails.logger.debug(msg)
313c309
<     Rails.logger.debug("Orchid##{msg}")
---
>     Rails.logger.debug(msg)
./app/models/search/on_orchids
./app/models/search/on_orchids/base.rb
./app/models/search/on_orchids/list_query.rb
./app/models/search/on_orchids/where_clauses.rb
./app/models/search/on_orchids/predicate.rb
./app/models/search/on_orchids/field_abbrev.rb
./app/models/search/on_orchids/count_query.rb
./app/models/search/on_orchids/field_rule.rb
./app/models/orchid
diff ../ned/app/models/orchid/as_instance_creator.rb ./app/models/orchid/as_instance_creator.rb
28d27
<     debug("Orchid::AsInstanceCreator#create_instance_for_preferred_matches")
29a29
>     debug('  Create instance for preferred matches')
32d31
<       debug(preferred_match.class)
33a33
>         return 1
34a35
>         return 0
36c37,39
<         records += preferred_match.create_instance(@ref)
---
>         debug('      Create instance')
>         preferred_match.create_instance(@ref)
>         records += 1
43a47
>       debug('  Orchid is excluded from further processing.')
45a50
>       debug("  Orchid's parent is excluded from further processing.")
48c53
<       debug("stop_everything?  Orchid is a hybrid cross - not ready to process these.")
---
>       debug("  Orchid is a hybrid cross - not ready to process these.")
62c67
<     debug "record_failure Failure: #{msg}"
---
>     debug "Failure: #{msg}"
72c77
<     Rails.logger.debug("Orchid##{msg}")
---
>     Rails.logger.debug(msg)
diff ../ned/app/models/orchid/as_name_matcher.rb ./app/models/orchid/as_name_matcher.rb
79c79
<     !@orchid.name_match_no_primary?
---
>     !@orchid.name_match_no_primary
diff ../ned/app/models/orchid/as_tree_placer.rb ./app/models/orchid/as_tree_placer.rb
19c19
< #  We need to place Orchids on a draft tree.
---
> #  Name services
21,26c21,23
<   attr_reader :status, :error, :placed_count
<   ERROR = 'error'
<   def initialize(draft_tree, orchid)
<     @draft_tree = draft_tree
<     @draft_name = draft_tree.draft_name
<     @status = 'started'
---
>   
>   def initialize(tree_version_draft_name, orchid)
>     debug("tree_version_draft_name: #{tree_version_draft_name}")
28,60c25,30
<     @placed_count = 0
<     @error = ''
<     preflight_checks
<     unless @status == ERROR
<       peek
<       @placed_count = place_or_replace
<     end
<   end
< 
<   def preflight_checks
<     case 
<     when @draft_tree.blank?
<       @status = ERROR
<       @error = "No such draft #{@draft_tree.draft_name}"
<     when @orchid.preferred_match.blank?
<       @status = ERROR
<       @error = "No preferred matching name for #{@orchid.taxon}"
<     when @orchid.orchids_name.blank? || @orchid.orchids_name.first.standalone_instance_id.blank?
<       @status = ERROR
<       @error = "No instance identified for #{@orchid.taxon}"
<     when @orchid.orchids_name.first.drafted?
<       @status = ERROR
<       @error = "Stopping because #{@orchid.taxon} is already on the draft tree"
<     when @orchid.exclude_from_further_processing?
<       @status = ERROR
<       @error = "#{@orchid.taxon} is excluded from further processing"
<     when @orchid.parent.try('exclude_from_further_processing?')
<       @status = ERROR
<       @error = "Parent of #{@orchid.taxon} is excluded from further processing"
<     when @orchid.hybrid_cross?
<       @status = ERROR
<       @error = "#{@orchid.taxon} is a hybrid cross - not ready to process these"
<     end
---
>     @tree_version = Tree::DraftVersion.where(draft_name:
>                                                    tree_version_draft_name)
>                                             .first
>     throw "No such draft #{tree_version_draft_name}" if @tree_version.blank?
>     peek
>     place_or_replace
64d33
<     debug("#{'peek '*20}")
66,69c35,38
<     debug("@draft_tree.class: #{@draft_tree.class}")
<     debug("@draft_tree.tree.config: #{@draft_tree.tree.config}")
<     debug("@draft_tree.tree.config['comment_key']: #{@draft_tree.tree.config['comment_key']}")
<     debug("@draft_tree.tree.config['distribution_key']: #{@draft_tree.tree.config['distribution_key']}")
---
>     debug("@tree_version.class: #{@tree_version.class}")
>     debug("@tree_version.tree.config: #{@tree_version.tree.config}")
>     debug("@tree_version.tree.config['comment_key']: #{@tree_version.tree.config['comment_key']}")
>     debug("@tree_version.tree.config['distribution_key']: #{@tree_version.tree.config['distribution_key']}")
84,92c53,56
<     @orchid.orchids_name.each do |one_orchid_name|
<       debug("one_orchid_name: id #{one_orchid_name.id}")
<       debug("one_orchid_name.standalone_instance: #{one_orchid_name.standalone_instance}")
<       debug("one_orchid_name.standalone_instance.name: #{one_orchid_name.standalone_instance.name}")
<       debug("one_orchid_name.standalone_instance.name.simple_name: #{one_orchid_name.standalone_instance.name.simple_name}")
<       debug("@draft_tree.id: #{@draft_tree.inspect}")
<       debug("one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree): #{one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree)}")
<       debug "name: #{one_orchid_name.name_id}; instance: #{one_orchid_name.standalone_instance_id}"
<       if one_orchid_name.standalone_instance_id.blank?
---
>     return if stop_everything?
>     @orchid.orchids_name.each do |orchids_name|
>       debug "name: #{orchids_name.name_id}; instance: #{orchids_name.standalone_instance_id}"
>       if orchids_name.standalone_instance_id.blank?
94c58
<       elsif one_orchid_name.drafted?
---
>       elsif orchids_name.drafted?
97c61
<         @tree_version_element = @draft_tree.name_in_version(one_orchid_name.name)
---
>           tree_version_element = @tree_version.name_in_version(orchids_name.name)
100,104c64
<           return replace_name(one_orchid_name)
<         #elsif one_orchid_name.name.draft_instance_id(@draft_tree).present?
<         #elsif one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree) != one_orchid_name.standalone_instance.id
<           #debug 'name is in the draft already'
<           #replace_name(one_orchid_name)
---
>           replace_name(orchids_name)
107c67
<           return place_name(one_orchid_name)
---
>           place_name(orchids_name)
112a73,91
>   def stop_everything?
>     if @orchid.exclude_from_further_processing?
>       debug('  Orchid is excluded from further processing.')
>       return true
>     elsif @orchid.parent.try('exclude_from_further_processing?')
>       debug("  Orchid's parent is excluded from further processing.")
>       return true
>     elsif @orchid.hybrid_cross?
>       debug("  Orchid is a hybrid cross - not ready to process these.")
>       return true
>     end
>     false
>   end
> 
>   def name_is_on_the_draft?(the_name)
>     @tree_version_element = @tree_version.name_in_version(the_name)
>     return @tree_version_element.present?
>   end
> 
114c93
<     tree_version = @draft_tree
---
>     tree_version = @tree_version
121c100
<                                                version_id: @draft_tree.id)
---
>                                                version_id: @tree_version.id)
126c105
<     1
---
>     'placed'
136,137d114
<     debug("@tree_version_element: #{@tree_version_element}")
<     debug("@draft_tree.name_in_version(orchids_name.name): #{@draft_tree.name_in_version(orchids_name.name)}")
145d121
<     debug('after call to Tree::Workspace::Replacement')
147d122
<     debug('after call to replacement.replace')
151c126
<     1
---
>     'replaced'
155c130
<     @draft_tree.name_in_version(orchids_name.name.parent)
---
>     @tree_version.name_in_version(orchids_name.name.parent)
177c152
<                              value: @orchid.distribution.split(' | ').join(', '),
---
>                              value: @orchid.distribution.split(' | ').join(','),
186,187d160
<   private
< 
189c162
<     Rails.logger.debug("Orchid::AsTreePlacer #{msg}")
---
>     puts msg
191a165
> 
Common subdirectories: ../ned/app/models/orchid/as_typeahead and ./app/models/orchid/as_typeahead
./app/models/orchid/as_typeahead
./app/models/orchid/as_typeahead/for_parent.rb
./app/models/orchid/as_name_matcher.rb
79c79
<     !@orchid.name_match_no_primary?
---
>     !@orchid.name_match_no_primary
./app/models/orchid/as_tree_placer.rb
19c19
< #  We need to place Orchids on a draft tree.
---
> #  Name services
21,26c21,23
<   attr_reader :status, :error, :placed_count
<   ERROR = 'error'
<   def initialize(draft_tree, orchid)
<     @draft_tree = draft_tree
<     @draft_name = draft_tree.draft_name
<     @status = 'started'
---
>   
>   def initialize(tree_version_draft_name, orchid)
>     debug("tree_version_draft_name: #{tree_version_draft_name}")
28,60c25,30
<     @placed_count = 0
<     @error = ''
<     preflight_checks
<     unless @status == ERROR
<       peek
<       @placed_count = place_or_replace
<     end
<   end
< 
<   def preflight_checks
<     case 
<     when @draft_tree.blank?
<       @status = ERROR
<       @error = "No such draft #{@draft_tree.draft_name}"
<     when @orchid.preferred_match.blank?
<       @status = ERROR
<       @error = "No preferred matching name for #{@orchid.taxon}"
<     when @orchid.orchids_name.blank? || @orchid.orchids_name.first.standalone_instance_id.blank?
<       @status = ERROR
<       @error = "No instance identified for #{@orchid.taxon}"
<     when @orchid.orchids_name.first.drafted?
<       @status = ERROR
<       @error = "Stopping because #{@orchid.taxon} is already on the draft tree"
<     when @orchid.exclude_from_further_processing?
<       @status = ERROR
<       @error = "#{@orchid.taxon} is excluded from further processing"
<     when @orchid.parent.try('exclude_from_further_processing?')
<       @status = ERROR
<       @error = "Parent of #{@orchid.taxon} is excluded from further processing"
<     when @orchid.hybrid_cross?
<       @status = ERROR
<       @error = "#{@orchid.taxon} is a hybrid cross - not ready to process these"
<     end
---
>     @tree_version = Tree::DraftVersion.where(draft_name:
>                                                    tree_version_draft_name)
>                                             .first
>     throw "No such draft #{tree_version_draft_name}" if @tree_version.blank?
>     peek
>     place_or_replace
64d33
<     debug("#{'peek '*20}")
66,69c35,38
<     debug("@draft_tree.class: #{@draft_tree.class}")
<     debug("@draft_tree.tree.config: #{@draft_tree.tree.config}")
<     debug("@draft_tree.tree.config['comment_key']: #{@draft_tree.tree.config['comment_key']}")
<     debug("@draft_tree.tree.config['distribution_key']: #{@draft_tree.tree.config['distribution_key']}")
---
>     debug("@tree_version.class: #{@tree_version.class}")
>     debug("@tree_version.tree.config: #{@tree_version.tree.config}")
>     debug("@tree_version.tree.config['comment_key']: #{@tree_version.tree.config['comment_key']}")
>     debug("@tree_version.tree.config['distribution_key']: #{@tree_version.tree.config['distribution_key']}")
84,92c53,56
<     @orchid.orchids_name.each do |one_orchid_name|
<       debug("one_orchid_name: id #{one_orchid_name.id}")
<       debug("one_orchid_name.standalone_instance: #{one_orchid_name.standalone_instance}")
<       debug("one_orchid_name.standalone_instance.name: #{one_orchid_name.standalone_instance.name}")
<       debug("one_orchid_name.standalone_instance.name.simple_name: #{one_orchid_name.standalone_instance.name.simple_name}")
<       debug("@draft_tree.id: #{@draft_tree.inspect}")
<       debug("one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree): #{one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree)}")
<       debug "name: #{one_orchid_name.name_id}; instance: #{one_orchid_name.standalone_instance_id}"
<       if one_orchid_name.standalone_instance_id.blank?
---
>     return if stop_everything?
>     @orchid.orchids_name.each do |orchids_name|
>       debug "name: #{orchids_name.name_id}; instance: #{orchids_name.standalone_instance_id}"
>       if orchids_name.standalone_instance_id.blank?
94c58
<       elsif one_orchid_name.drafted?
---
>       elsif orchids_name.drafted?
97c61
<         @tree_version_element = @draft_tree.name_in_version(one_orchid_name.name)
---
>           tree_version_element = @tree_version.name_in_version(orchids_name.name)
100,104c64
<           return replace_name(one_orchid_name)
<         #elsif one_orchid_name.name.draft_instance_id(@draft_tree).present?
<         #elsif one_orchid_name.standalone_instance.name.draft_instance_id(@draft_tree) != one_orchid_name.standalone_instance.id
<           #debug 'name is in the draft already'
<           #replace_name(one_orchid_name)
---
>           replace_name(orchids_name)
107c67
<           return place_name(one_orchid_name)
---
>           place_name(orchids_name)
112a73,91
>   def stop_everything?
>     if @orchid.exclude_from_further_processing?
>       debug('  Orchid is excluded from further processing.')
>       return true
>     elsif @orchid.parent.try('exclude_from_further_processing?')
>       debug("  Orchid's parent is excluded from further processing.")
>       return true
>     elsif @orchid.hybrid_cross?
>       debug("  Orchid is a hybrid cross - not ready to process these.")
>       return true
>     end
>     false
>   end
> 
>   def name_is_on_the_draft?(the_name)
>     @tree_version_element = @tree_version.name_in_version(the_name)
>     return @tree_version_element.present?
>   end
> 
114c93
<     tree_version = @draft_tree
---
>     tree_version = @tree_version
121c100
<                                                version_id: @draft_tree.id)
---
>                                                version_id: @tree_version.id)
126c105
<     1
---
>     'placed'
136,137d114
<     debug("@tree_version_element: #{@tree_version_element}")
<     debug("@draft_tree.name_in_version(orchids_name.name): #{@draft_tree.name_in_version(orchids_name.name)}")
145d121
<     debug('after call to Tree::Workspace::Replacement')
147d122
<     debug('after call to replacement.replace')
151c126
<     1
---
>     'replaced'
155c130
<     @draft_tree.name_in_version(orchids_name.name.parent)
---
>     @tree_version.name_in_version(orchids_name.name.parent)
177c152
<                              value: @orchid.distribution.split(' | ').join(', '),
---
>                              value: @orchid.distribution.split(' | ').join(','),
186,187d160
<   private
< 
189c162
<     Rails.logger.debug("Orchid::AsTreePlacer #{msg}")
---
>     puts msg
191a165
> 
./app/models/orchid/as_instance_creator.rb
28d27
<     debug("Orchid::AsInstanceCreator#create_instance_for_preferred_matches")
29a29
>     debug('  Create instance for preferred matches')
32d31
<       debug(preferred_match.class)
33a33
>         return 1
34a35
>         return 0
36c37,39
<         records += preferred_match.create_instance(@ref)
---
>         debug('      Create instance')
>         preferred_match.create_instance(@ref)
>         records += 1
43a47
>       debug('  Orchid is excluded from further processing.')
45a50
>       debug("  Orchid's parent is excluded from further processing.")
48c53
<       debug("stop_everything?  Orchid is a hybrid cross - not ready to process these.")
---
>       debug("  Orchid is a hybrid cross - not ready to process these.")
62c67
<     debug "record_failure Failure: #{msg}"
---
>     debug "Failure: #{msg}"
72c77
<     Rails.logger.debug("Orchid##{msg}")
---
>     Rails.logger.debug(msg)
./app/javascript/packs/typeaheads/for_orchids
./app/javascript/packs/typeaheads/for_orchids/parent.js
./app/controllers/orchids_controller.rb
20c20
<   before_filter :find_orchid, only: [:show, :update, :tab, :destroy]
---
>   before_action :find_orchid, only: [:show, :update, :tab, :destroy]
31d30
<     logger.debug("OrchidsController#update")
41,42c40
<     logger.error("OrchidsController#update: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
---
>     logger.error(e.to_s)
./app/controllers/orchids_names_controller.rb
20c20
<   before_filter :find_orchids_name, only: [:show, :update]
---
>   before_action :find_orchids_name, only: [:show, :update]
./app/controllers/orchids_batch_controller.rb
26,27d25
<     logger.error("OrchidsBatchController#create_preferred_matches: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
33d30
<     logger.debug("#create_instances_for_preferred_matches start")
38,59d34
<     logger.error("OrchidsBatchController#create_instances_for_preferred_matches: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
<     @message = e.to_s.sub(/uncaught throw/,'').gsub(/"/,'')
<     render 'error'
<   end
< 
<   def add_instances_to_draft_tree
<     logger.debug("#add_instances_to_draft_tree start")
<     records, errors = Orchid.add_to_tree_for(@working_draft, params[:taxon_string])
<     logger.debug("records added to tree: #{records}")
<     @message = %Q(Added #{records} #{'instance'.pluralize(records)})
<     @message += %Q( to tree "#{@working_draft.draft_name}" tree for orchids )
<     @message += %Q( matching "#{params[:taxon_string]}")
<     if errors.strip.blank?
<       @errors = nil
<     else
<       @errors = %Q(Errors not blank: #{errors.length})
<     end
<     render 'create'
<   rescue => e
<     logger.error("OrchidsBatchController#add_instances_to_draft_tree: #{e.to_s}")
<     logger.error e.backtrace.join("\n")
70,73d44
< 
<   def debug(msg)
<     logger.debug('OrchidsBatchController')
<   end
./app/views/orchids_names
./app/views/orchids_names/update_error.js.erb
./app/views/orchids_names/update.js.erb
./app/views/orchids_names/create.js.erb
./app/views/orchids
diff ../ned/app/views/orchids/_form_for_synonym.html.erb ./app/views/orchids/_form_for_synonym.html.erb
39c39
<     <%= render partial: "synonym_type", locals: {f: f, orchid: orchid} %>
---
>     <%= render partial: "synonym_type", locals: {f: f} %>
diff ../ned/app/views/orchids/_new_row.html.erb ./app/views/orchids/_new_row.html.erb
0a1
> <% link = "link-new-author-#{@random_id}" %>
9a11
>                 id: "#{link}",
18c20,26
< <script>$('tr#new-orchid-<%= @random_id %> a.show-details-link').click();</script>
---
> <script>
>   $(document).ready(function () {
>     document.getElementById("<%= link %>").click();
>   })
> </script>
> 
> 
diff ../ned/app/views/orchids/_synonym_type.html.erb ./app/views/orchids/_synonym_type.html.erb
3c3
<     <label for="synonym_type">Synonym type*
---
>     <label for="synonym_type">Synonym type<%= "*" unless @orchid.accepted? %>
6c6,7
<       ['alternative name',
---
>       ['',
>        'alternative name',
11,12d11
<        ['heterotypic [deprecated]','heterotypic'],
<        ['homotypic [deprecated]','homotypic'],
18,19c17
<        {disabled: ['heterotypic','homotypic']},
<        class: 'form-control',
---
>     {}, class: 'form-control',
21c19
<     required: true,
---
>     #{"required: true," unless @orchid.accepted?}
diff ../ned/app/views/orchids/_tab_batch.html.erb ./app/views/orchids/_tab_batch.html.erb
33,54d32
< <% if Rails.configuration.try('allow_orchid_tree_operations') %>
< 
< <h5>Add instances to a draft tree for names identified by this query string</h5>
< 
< <% if @working_draft.nil? %>
<   Please choose a draft from the tree menu first.
< <% else %>
<   Draft tree: <%= @working_draft.draft_name %>
<   <br>
< 
<   <%= form_tag({controller: "orchids_batch", action: "add_instances_to_draft_tree"}, method: "post", remote: true) do %>
<     <input name="taxon_string" type="text" value="<%= @orchid.taxon %>" class="form-control" required title="taxon string for batch" />
<     <input id="add-instances-to-draft-treebatch-submit" name="submit" type="submit" value="Submit" class="btn btn-primary width-5em" title="Submit the form" />
<   <% end %>
< 
< <% end %>
< 
< <%= divider %>
< 
< <% else %>
<   Orchid tree operations are switched off in this environment.
< <% end %>
diff ../ned/app/views/orchids/_tab_show_1_name_matches_standard.html.erb ./app/views/orchids/_tab_show_1_name_matches_standard.html.erb
15,21c15,16
<     <% if @orchid.synonym_without_synonym_type? %>
<       <span class="red">
<       This orchid is a synonym without a synonym type.  You can fix that on the Edit tab.
<       </span>
<     <% end %>
<     <% disable_radio_button = !matching_name.has_primary_instance? || matching_name.duplicate? || @orchid.synonym_without_synonym_type? %>
<         <% pi_count += 1 unless !matching_name.has_primary_instance? %>
---
>     <% disable_radio_button = !matching_name.has_primary_instance? %>
>         <% pi_count += 1 unless disable_radio_button %>
26,28d20
<         <% if matching_name.duplicate? %>
<           <span class="matching-name-is-a-duplicate">[Duplicate]</span>
<         <% end %>
diff ../ned/app/views/orchids/_tab_show_standard_preferred_match_info.html.erb ./app/views/orchids/_tab_show_standard_preferred_match_info.html.erb
20,26d19
<       <br>
<       <% unless orchids_name.standalone_instance.name.draft_instance_id(@working_draft).blank? %>
<         Name is already in workspace <b><%= @working_draft.draft_name %></b>
<         <% unless orchids_name.standalone_instance.name.draft_instance_id(@working_draft) == orchids_name.standalone_instance.id %>
<           for a different instance.
<         <% end %>
<       <% end %>
Common subdirectories: ../ned/app/views/orchids/advanced_search and ./app/views/orchids/advanced_search
Common subdirectories: ../ned/app/views/orchids/form and ./app/views/orchids/form
Common subdirectories: ../ned/app/views/orchids/stats and ./app/views/orchids/stats
./app/views/orchids/_tab_show_standard_preferred_match_info.html.erb
20,26d19
<       <br>
<       <% unless orchids_name.standalone_instance.name.draft_instance_id(@working_draft).blank? %>
<         Name is already in workspace <b><%= @working_draft.draft_name %></b>
<         <% unless orchids_name.standalone_instance.name.draft_instance_id(@working_draft) == orchids_name.standalone_instance.id %>
<           for a different instance.
<         <% end %>
<       <% end %>
./app/views/orchids/_delete_widgets.html.erb
./app/views/orchids/form
./app/views/orchids/form/_parent.html.erb
./app/views/orchids/stats.js.erb
./app/views/orchids/_form_for_synonym.html.erb
39c39
<     <%= render partial: "synonym_type", locals: {f: f, orchid: orchid} %>
---
>     <%= render partial: "synonym_type", locals: {f: f} %>
./app/views/orchids/_tab_delete.html.erb
./app/views/orchids/_new_row.html.erb
0a1
> <% link = "link-new-author-#{@random_id}" %>
9a11
>                 id: "#{link}",
18c20,26
< <script>$('tr#new-orchid-<%= @random_id %> a.show-details-link').click();</script>
---
> <script>
>   $(document).ready(function () {
>     document.getElementById("<%= link %>").click();
>   })
> </script>
> 
> 
./app/views/orchids/_synonym_type.html.erb
3c3
<     <label for="synonym_type">Synonym type*
---
>     <label for="synonym_type">Synonym type<%= "*" unless @orchid.accepted? %>
6c6,7
<       ['alternative name',
---
>       ['',
>        'alternative name',
11,12d11
<        ['heterotypic [deprecated]','heterotypic'],
<        ['homotypic [deprecated]','homotypic'],
18,19c17
<        {disabled: ['heterotypic','homotypic']},
<        class: 'form-control',
---
>     {}, class: 'form-control',
21c19
<     required: true,
---
>     #{"required: true," unless @orchid.accepted?}
./app/views/orchids/new_row.js.erb
./app/views/orchids/update_error.js.erb
./app/views/orchids/new.js.erb
./app/views/orchids/destroy.js.erb
./app/views/orchids/update_no_change.js.erb
./app/views/orchids/create_error.js.erb
./app/views/orchids/_tabs.html.erb
./app/views/orchids/_tab_create_misapp.html.erb
./app/views/orchids/_form_for_accepted.html.erb
./app/views/orchids/_new.html.erb
./app/views/orchids/_tab_show_1_name_matches_standard.html.erb
15,21c15,16
<     <% if @orchid.synonym_without_synonym_type? %>
<       <span class="red">
<       This orchid is a synonym without a synonym type.  You can fix that on the Edit tab.
<       </span>
<     <% end %>
<     <% disable_radio_button = !matching_name.has_primary_instance? || matching_name.duplicate? || @orchid.synonym_without_synonym_type? %>
<         <% pi_count += 1 unless !matching_name.has_primary_instance? %>
---
>     <% disable_radio_button = !matching_name.has_primary_instance? %>
>         <% pi_count += 1 unless disable_radio_button %>
26,28d20
<         <% if matching_name.duplicate? %>
<           <span class="matching-name-is-a-duplicate">[Duplicate]</span>
<         <% end %>
./app/views/orchids/update.js.erb
./app/views/orchids/_tab_show_1_more_info.html.erb
./app/views/orchids/_tab_show_1_name_matches_misapplied.html.erb
./app/views/orchids/_form_for_hybrid_cross.html.erb
./app/views/orchids/_tab.html.erb
./app/views/orchids/create.js.erb
./app/views/orchids/_tab_chosen.html.erb
./app/views/orchids/destroy_error.js.erb
./app/views/orchids/show.html.erb
./app/views/orchids/_tab_show_1.html.erb
./app/views/orchids/_tab_create_syn.html.erb
./app/views/orchids/_ex_base_author.html.erb
./app/views/orchids/_form_for_misapp.html.erb
./app/views/orchids/_tab_show_1_name_matches.html.erb
./app/views/orchids/_authors.html.erb
./app/views/orchids/_tab_show_1_core_info.html.erb
./app/views/orchids/_name_status.html.erb
./app/views/orchids/stats
./app/views/orchids/stats/_nsl_rank_really_excluded_stats.html.erb
./app/views/orchids/stats/_nsl_rank_accepted_stats.html.erb
./app/views/orchids/stats/_ranks_by_record_type.html.erb
./app/views/orchids/stats/_high_level_stats.html.erb
./app/views/orchids/stats/_nsl_rank_synonym_stats.html.erb
./app/views/orchids/stats/_rank_stats.html.erb
./app/views/orchids/stats/_nsl_rank_stats.html.erb
./app/views/orchids/stats/_nsl_rank_misapps_stats.html.erb
./app/views/orchids/stats/_name_status.html.erb
./app/views/orchids/stats/_nsl_rank_really_accepted_stats.html.erb
./app/views/orchids/stats/_nsl_rank_hybrid_cross_stats.html.erb
./app/views/orchids/advanced_search
./app/views/orchids/advanced_search/_field_help.html.erb
./app/views/orchids/advanced_search/_examples.html.erb
./app/views/orchids/advanced_search/_help.html.erb
./app/views/orchids/_tab_edit.html.erb
./app/views/orchids/_tab_batch.html.erb
33,54d32
< <% if Rails.configuration.try('allow_orchid_tree_operations') %>
< 
< <h5>Add instances to a draft tree for names identified by this query string</h5>
< 
< <% if @working_draft.nil? %>
<   Please choose a draft from the tree menu first.
< <% else %>
<   Draft tree: <%= @working_draft.draft_name %>
<   <br>
< 
<   <%= form_tag({controller: "orchids_batch", action: "add_instances_to_draft_tree"}, method: "post", remote: true) do %>
<     <input name="taxon_string" type="text" value="<%= @orchid.taxon %>" class="form-control" required title="taxon string for batch" />
<     <input id="add-instances-to-draft-treebatch-submit" name="submit" type="submit" value="Submit" class="btn btn-primary width-5em" title="Submit the form" />
<   <% end %>
< 
< <% end %>
< 
< <%= divider %>
< 
< <% else %>
<   Orchid tree operations are switched off in this environment.
< <% end %>
./app/views/orchids_batch
diff ../ned/app/views/orchids_batch/create.js.erb ./app/views/orchids_batch/create.js.erb
3c3
< $('#search-result-details-info-message-container').html("<%= escape_javascript(@message) %><br><%= escape_javascript(@errors) %>");
---
> $('#search-result-details-info-message-container').html("<%= escape_javascript(@message) %>");
./app/views/orchids_batch/error.js.erb
./app/views/orchids_batch/create.js.erb
3c3
< $('#search-result-details-info-message-container').html("<%= escape_javascript(@message) %><br><%= escape_javascript(@errors) %>");
---
> $('#search-result-details-info-message-container').html("<%= escape_javascript(@message) %>");
./app/views/application/_orchid_name_link_text.html.erb
24c24
<     <% if search_result.name_match_no_primary? %>
---
>     <% if search_result.name_match_no_primary %>
29c29
<     <% if search_result.name_match_no_primary? %>
---
>     <% if search_result.name_match_no_primary %>
./app/views/application/_orchid_record.html.erb
